name: deploy-pypi

on:
    push:
        branches:
            - master

jobs:
    build-and-deploy:
        runs-on: ubuntu-latest
        name: Publish to PyPi
        steps:
            - name: Setup python
              uses: actions/setup-python@v1
              with:
                  python-version: 3.8

            - name: Install dependencies
              run: |
                  python -m pip install --upgrade pip
                  python -m pip install --upgrade twine
                  python -m pip install --upgrade wheel

            - name: Checkout
              uses: actions/checkout@v2

            - name: Build manylinux Python wheels
              uses: RalfG/python-wheels-manylinux-build@v0.3.3-manylinux2014_x86_64
              with:
                python-versions: 'cp36-cp36m cp37-cp37m cp38-cp38m'
                build-requirements: 'cython numpy'

            - name: Publish to PyPi
              uses: pypa/gh-action-pypi-publish@master
              with:
                  user: __token__
                  password: ${{ secrets.pypi_password }}
